<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory PWA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="icon" type="image/png" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            background: #2c3e50;
            padding: 0;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: white;
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .nav-btn:hover {
            background: #34495e;
        }
        
        .nav-btn.active {
            background: #3498db;
        }
        
        .view {
            padding: 30px;
        }
        
        .hidden {
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .fade-in {
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .expiring-soon {
            background: #fff3cd !important;
        }
        
        .expired {
            background: #f8d7da !important;
        }
        
        .low-stock {
            background: #fff3cd !important;
        }
        
        .out-of-stock {
            background: #f8d7da !important;
        }
        
        .selected-row {
            background: #d4edff !important;
            border: 2px solid #667eea;
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .nav-btn {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 8px;
            }
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            color: #667eea;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .order-source-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .source-btn {
            background: #f8f9fa;
            border: 2px solid #ddd;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .source-btn:hover {
            border-color: #667eea;
        }
        
        .source-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Inventory Manager</h1>
            <p>Track, manage, and optimize your inventory</p>
        </div>
        
        <div class="nav">
            <button class="nav-btn active" onclick="switchView('home')">üè† Home</button>
            <button class="nav-btn" onclick="switchView('inventory')">üì¶ Inventory</button>
            <button class="nav-btn" onclick="switchView('expiry')">‚è∞ Expiry</button>
            <button class="nav-btn" onclick="switchView('notes')">üìù Notes</button>
            <button class="nav-btn" onclick="switchView('orders')">üõí Orders</button>
            <button class="nav-btn" onclick="switchView('tracking')">üöö Tracking</button>
        </div>
        
        <!-- Home View -->
        <div id="view-home" class="view">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="total-items">0</h3>
                    <p>Total Items</p>
                </div>
                <div class="stat-card">
                    <h3 id="expiring-soon">0</h3>
                    <p>Expiring Soon</p>
                </div>
                <div class="stat-card">
                    <h3 id="low-stock">0</h3>
                    <p>Low Stock</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-notes">0</h3>
                    <p>Notes</p>
                </div>
            </div>
            
            <h2>Recent Activity</h2>
            <div id="recent-activity"></div>
        </div>
        
        <!-- Inventory View -->
        <div id="view-inventory" class="view hidden">
            <div class="action-buttons">
                <button class="btn" onclick="showAddItemModal()">‚ûï Add Item</button>
                <button class="btn btn-success" onclick="showEditItemModal()" id="edit-inv-btn" disabled>‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" onclick="deleteInventoryItem()" id="delete-inv-btn" disabled>üóëÔ∏è Delete</button>
            </div>
            
            <input type="text" id="inv-search" class="search-box" placeholder="üîç Search items..." oninput="renderInvTable()">
            
            <table id="inv-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Min Stock</th>
                        <th>Price</th>
                        <th>Expiry Date</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- Expiry View -->
        <div id="view-expiry" class="view hidden">
            <div class="action-buttons">
                <button class="btn btn-danger" onclick="deleteExpiredItem()" id="delete-exp-btn" disabled>üóëÔ∏è Delete</button>
            </div>
            
            <input type="text" id="exp-search" class="search-box" placeholder="üîç Search expiring items..." oninput="renderExpTable()">
            
            <table id="exp-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Expiry Date</th>
                        <th>Days Left</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- Notes View -->
        <div id="view-notes" class="view hidden">
            <div class="action-buttons">
                <button class="btn" onclick="showAddNoteModal()">‚ûï Add Note</button>
                <button class="btn btn-success" onclick="showEditNoteModal()" id="edit-note-btn" disabled>‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" onclick="deleteNote()" id="delete-note-btn" disabled>üóëÔ∏è Delete</button>
            </div>
            
            <input type="text" id="note-search" class="search-box" placeholder="üîç Search notes..." oninput="renderNoteTable()">
            
            <table id="note-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Content</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- Orders View -->
        <div id="view-orders" class="view hidden">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchOrdersTab('incoming')">üì• Incoming</button>
                <button class="tab-btn" onclick="switchOrdersTab('outgoing')">üì§ Outgoing</button>
            </div>
            
            <div class="order-source-selector">
                <button class="source-btn active" onclick="setOrderSource('suppliers')">üè¢ Suppliers</button>
                <button class="source-btn" onclick="setOrderSource('customers')">üë• Customers</button>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="showAddOrderModal()">‚ûï Add Order</button>
                <button class="btn btn-success" onclick="showEditOrderModal()" id="edit-order-btn" disabled>‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" onclick="deleteOrder()" id="delete-order-btn" disabled>üóëÔ∏è Delete</button>
            </div>
            
            <input type="text" id="order-search" class="search-box" placeholder="üîç Search orders..." oninput="renderOrderTable()">
            
            <table id="order-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Source/Destination</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- Tracking View -->
        <div id="view-tracking" class="view hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="tracking-total">0</h3>
                    <p>Total Shipments</p>
                </div>
                <div class="stat-card">
                    <h3 id="tracking-in-transit">0</h3>
                    <p>In Transit</p>
                </div>
                <div class="stat-card">
                    <h3 id="tracking-delivered">0</h3>
                    <p>Delivered</p>
                </div>
                <div class="stat-card">
                    <h3 id="tracking-pending">0</h3>
                    <p>Pending</p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="showAddTrackingModal()">‚ûï Add Tracking</button>
                <button class="btn btn-success" onclick="showEditTrackingModal()" id="edit-tracking-btn" disabled>‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" onclick="deleteTracking()" id="delete-tracking-btn" disabled>üóëÔ∏è Delete</button>
            </div>
            
            <input type="text" id="tracking-search" class="search-box" placeholder="üîç Search tracking numbers..." oninput="renderTrackingTable()">
            
            <table id="tracking-table">
                <thead>
                    <tr>
                        <th>Tracking Number</th>
                        <th>Carrier</th>
                        <th>Status</th>
                        <th>Origin</th>
                        <th>Destination</th>
                        <th>Ship Date</th>
                        <th>Est. Delivery</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <!-- Add/Edit Item Modal -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <h2 id="item-modal-title">Add Item</h2>
            <form id="item-form" onsubmit="saveInventoryItem(event)">
                <div class="form-group">
                    <label>Item Name</label>
                    <input type="text" id="item-name" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" id="item-category" required>
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="item-quantity" required min="0">
                </div>
                <div class="form-group">
                    <label>Minimum Stock</label>
                    <input type="number" id="item-min-stock" required min="0">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" id="item-price" step="0.01" required min="0">
                </div>
                <div class="form-group">
                    <label>Expiry Date</label>
                    <input type="date" id="item-expiry">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeItemModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add/Edit Note Modal -->
    <div id="note-modal" class="modal">
        <div class="modal-content">
            <h2 id="note-modal-title">Add Note</h2>
            <form id="note-form" onsubmit="saveNote(event)">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="note-title" required>
                </div>
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="note-content" required></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeNoteModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add/Edit Order Modal -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <h2 id="order-modal-title">Add Order</h2>
            <form id="order-form" onsubmit="saveOrder(event)">
                <div class="form-group">
                    <label>Order ID</label>
                    <input type="text" id="order-id" required>
                </div>
                <div class="form-group">
                    <label id="order-source-label">Source/Destination</label>
                    <input type="text" id="order-source" required>
                </div>
                <div class="form-group">
                    <label>Items</label>
                    <textarea id="order-items" required placeholder="Enter items, one per line"></textarea>
                </div>
                <div class="form-group">
                    <label>Total Amount</label>
                    <input type="number" id="order-total" step="0.01" required min="0">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="order-date" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="order-status" required>
                        <option value="pending">Pending</option>
                        <option value="processing">Processing</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeOrderModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add/Edit Tracking Modal -->
    <div id="tracking-modal" class="modal">
        <div class="modal-content">
            <h2 id="tracking-modal-title">Add Tracking</h2>
            <form id="tracking-form" onsubmit="saveTracking(event)">
                <div class="form-group">
                    <label>Tracking Number</label>
                    <input type="text" id="tracking-number" required>
                </div>
                <div class="form-group">
                    <label>Carrier</label>
                    <input type="text" id="tracking-carrier" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="tracking-status" required>
                        <option value="pending">Pending</option>
                        <option value="picked-up">Picked Up</option>
                        <option value="in-transit">In Transit</option>
                        <option value="out-for-delivery">Out for Delivery</option>
                        <option value="delivered">Delivered</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Origin</label>
                    <input type="text" id="tracking-origin" required>
                </div>
                <div class="form-group">
                    <label>Destination</label>
                    <input type="text" id="tracking-destination" required>
                </div>
                <div class="form-group">
                    <label>Ship Date</label>
                    <input type="date" id="tracking-ship-date" required>
                </div>
                <div class="form-group">
                    <label>Estimated Delivery</label>
                    <input type="date" id="tracking-est-delivery" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeTrackingModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }

        // Global variables
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let tracking = JSON.parse(localStorage.getItem('tracking')) || [];
        let currentView = 'home';
        let editingItemIdx = -1;
        let editingNoteIdx = -1;
        let editingOrderIdx = -1;
        let editingTrackingIdx = -1;
        let selectedItemIdx = -1;
        let activeOrdersTab = 'incoming';
        let activeOrderSource = 'suppliers';

        // Initialize app
        function init() {
            updateDashboardStats();
            updateNavButtons();
        }

        // Update navigation buttons
        function updateNavButtons() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = Array.from(document.querySelectorAll('.nav-btn'))
                .find(btn => btn.textContent.toLowerCase().includes(currentView));
            if (activeBtn) activeBtn.classList.add('active');
        }

        // Switch view
        function switchView(viewName) {
            currentView = viewName;
            ['view-home', 'view-inventory', 'view-expiry', 'view-notes', 'view-orders', 'view-tracking'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            document.getElementById(`view-${viewName}`).classList.add('fade-in');

            selectedItemIdx = -1;
            
            if (viewName === 'inventory') {
                resetInvUI();
                renderInvTable();
                setTimeout(() => document.getElementById('inv-search').focus(), 100);
            } else if (viewName === 'expiry') {
                resetExpUI();
                renderExpTable();
            } else if (viewName === 'notes') {
                resetNoteUI();
                renderNoteTable();
            } else if (viewName === 'orders') {
                switchOrdersTab(activeOrdersTab);
                setOrderSource(activeOrderSource);
            } else if (viewName === 'tracking') {
                renderTrackingTable();
                updateTrackingStats();
            } else if (viewName === 'home') {
                updateDashboardStats();
            }
            
            updateNavButtons();
        }

        // Dashboard stats
        function updateDashboardStats() {
            const totalItems = inventory.length;
            const expiringSoon = inventory.filter(item => {
                if (!item.expiryDate) return false;
                const daysLeft = Math.ceil((new Date(item.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                return daysLeft <= 30 && daysLeft > 0;
            }).length;
            const lowStock = inventory.filter(item => item.quantity <= item.minStock).length;
            const totalNotes = notes.length;

            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('expiring-soon').textContent = expiringSoon;
            document.getElementById('low-stock').textContent = lowStock;
            document.getElementById('total-notes').textContent = totalNotes;
        }

        // Inventory functions
        function resetInvUI() {
            selectedItemIdx = -1;
            document.getElementById('edit-inv-btn').disabled = true;
            document.getElementById('delete-inv-btn').disabled = true;
        }

        function renderInvTable() {
            const search = document.getElementById('inv-search').value.toLowerCase();
            const tbody = document.querySelector('#inv-table tbody');
            tbody.innerHTML = '';

            const filtered = inventory.filter(item =>
                item.name.toLowerCase().includes(search) ||
                item.category.toLowerCase().includes(search)
            );

            filtered.forEach((item, idx) => {
                const tr = document.createElement('tr');
                const isLowStock = item.quantity <= item.minStock;
                const isOutOfStock = item.quantity === 0;
                
                if (isOutOfStock) tr.classList.add('out-of-stock');
                else if (isLowStock) tr.classList.add('low-stock');
                
                if (idx === selectedItemIdx) tr.classList.add('selected-row');
                
                tr.onclick = () => selectInventoryRow(idx);
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.quantity}</td>
                    <td>${item.minStock}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>${item.expiryDate || 'N/A'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function selectInventoryRow(idx) {
            selectedItemIdx = idx;
            renderInvTable();
            document.getElementById('edit-inv-btn').disabled = false;
            document.getElementById('delete-inv-btn').disabled = false;
        }

        function showAddItemModal() {
            editingItemIdx = -1;
            document.getElementById('item-modal-title').textContent = 'Add Item';
            document.getElementById('item-form').reset();
            document.getElementById('item-modal').style.display = 'block';
        }

        function showEditItemModal() {
            if (selectedItemIdx === -1) return;
            editingItemIdx = selectedItemIdx;
            const item = inventory[selectedItemIdx];
            
            document.getElementById('item-modal-title').textContent = 'Edit Item';
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-category').value = item.category;
            document.getElementById('item-quantity').value = item.quantity;
            document.getElementById('item-min-stock').value = item.minStock;
            document.getElementById('item-price').value = item.price;
            document.getElementById('item-expiry').value = item.expiryDate || '';
            
            document.getElementById('item-modal').style.display = 'block';
        }

        function closeItemModal() {
            document.getElementById('item-modal').style.display = 'none';
            editingItemIdx = -1;
        }

        function saveInventoryItem(e) {
            e.preventDefault();
            
            const item = {
                name: document.getElementById('item-name').value,
                category: document.getElementById('item-category').value,
                quantity: parseInt(document.getElementById('item-quantity').value),
                minStock: parseInt(document.getElementById('item-min-stock').value),
                price: parseFloat(document.getElementById('item-price').value),
                expiryDate: document.getElementById('item-expiry').value
            };

            if (editingItemIdx === -1) {
                inventory.push(item);
            } else {
                inventory[editingItemIdx] = item;
            }

            localStorage.setItem('inventory', JSON.stringify(inventory));
            closeItemModal();
            renderInvTable();
            updateDashboardStats();
        }

        function deleteInventoryItem() {
            if (selectedItemIdx === -1) return;
            if (confirm('Are you sure you want to delete this item?')) {
                inventory.splice(selectedItemIdx, 1);
                localStorage.setItem('inventory', JSON.stringify(inventory));
                resetInvUI();
                renderInvTable();
                updateDashboardStats();
            }
        }

        // Expiry functions
        function resetExpUI() {
            selectedItemIdx = -1;
            document.getElementById('delete-exp-btn').disabled = true;
        }

        function renderExpTable() {
            const search = document.getElementById('exp-search').value.toLowerCase();
            const tbody = document.querySelector('#exp-table tbody');
            tbody.innerHTML = '';

            const withExpiry = inventory.filter(item => item.expiryDate);
            const filtered = withExpiry.filter(item =>
                item.name.toLowerCase().includes(search) ||
                item.category.toLowerCase().includes(search)
            );

            filtered.forEach((item, idx) => {
                const daysLeft = Math.ceil((new Date(item.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                const tr = document.createElement('tr');
                
                if (daysLeft < 0) tr.classList.add('expired');
                else if (daysLeft <= 30) tr.classList.add('expiring-soon');
                
                if (idx === selectedItemIdx) tr.classList.add('selected-row');
                
                tr.onclick = () => selectExpiryRow(idx);
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.quantity}</td>
                    <td>${item.expiryDate}</td>
                    <td>${daysLeft}</td>
                    <td>${daysLeft < 0 ? '‚ùå Expired' : daysLeft <= 30 ? '‚ö†Ô∏è Expiring Soon' : '‚úÖ Good'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function selectExpiryRow(idx) {
            selectedItemIdx = idx;
            renderExpTable();
            document.getElementById('delete-exp-btn').disabled = false;
        }

        function deleteExpiredItem() {
            if (selectedItemIdx === -1) return;
            const withExpiry = inventory.filter(item => item.expiryDate);
            const itemToDelete = withExpiry[selectedItemIdx];
            const actualIdx = inventory.indexOf(itemToDelete);
            
            if (confirm('Are you sure you want to delete this item?')) {
                inventory.splice(actualIdx, 1);
                localStorage.setItem('inventory', JSON.stringify(inventory));
                resetExpUI();
                renderExpTable();
                updateDashboardStats();
            }
        }

        // Notes functions
        function resetNoteUI() {
            selectedItemIdx = -1;
            document.getElementById('edit-note-btn').disabled = true;
            document.getElementById('delete-note-btn').disabled = true;
        }

        function renderNoteTable() {
            const search = document.getElementById('note-search').value.toLowerCase();
            const tbody = document.querySelector('#note-table tbody');
            tbody.innerHTML = '';

            const filtered = notes.filter(note =>
                note.title.toLowerCase().includes(search) ||
                note.content.toLowerCase().includes(search)
            );

            filtered.forEach((note, idx) => {
                const tr = document.createElement('tr');
                if (idx === selectedItemIdx) tr.classList.add('selected-row');
                
                tr.onclick = () => selectNoteRow(idx);
                tr.innerHTML = `
                    <td>${note.title}</td>
                    <td>${note.content.substring(0, 50)}...</td>
                    <td>${note.date}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function selectNoteRow(idx) {
            selectedItemIdx = idx;
            renderNoteTable();
            document.getElementById('edit-note-btn').disabled = false;
            document.getElementById('delete-note-btn').disabled = false;
        }

        function showAddNoteModal() {
            editingNoteIdx = -1;
            document.getElementById('note-modal-title').textContent = 'Add Note';
            document.getElementById('note-form').reset();
            document.getElementById('note-modal').style.display = 'block';
        }

        function showEditNoteModal() {
            if (selectedItemIdx === -1) return;
            editingNoteIdx = selectedItemIdx;
            const note = notes[selectedItemIdx];
            
            document.getElementById('note-modal-title').textContent = 'Edit Note';
            document.getElementById('note-title').value = note.title;
            document.getElementById('note-content').value = note.content;
            
            document.getElementById('note-modal').style.display = 'block';
        }

        function closeNoteModal() {
            document.getElementById('note-modal').style.display = 'none';
            editingNoteIdx = -1;
        }

        function saveNote(e) {
            e.preventDefault();
            
            const note = {
                title: document.getElementById('note-title').value,
                content: document.getElementById('note-content').value,
                date: new Date().toLocaleDateString()
            };

            if (editingNoteIdx === -1) {
                notes.push(note);
            } else {
                notes[editingNoteIdx] = note;
            }

            localStorage.setItem('notes', JSON.stringify(notes));
            closeNoteModal();
            renderNoteTable();
            updateDashboardStats();
        }

        function deleteNote() {
            if (selectedItemIdx === -1) return;
            if (confirm('Are you sure you want to delete this note?')) {
                notes.splice(selectedItemIdx, 1);
                localStorage.setItem('notes', JSON.stringify(notes));
                resetNoteUI();
                renderNoteTable();
                updateDashboardStats();
            }
        }

        // Orders functions
        function switchOrdersTab(tab) {
            activeOrdersTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOrderTable();
        }

        function setOrderSource(source) {
            activeOrderSource = source;
            document.querySelectorAll('.source-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOrderTable();
        }

        function renderOrderTable() {
            const search = document.getElementById('order-search').value.toLowerCase();
            const tbody = document.querySelector('#order-table tbody');
            tbody.innerHTML = '';

            const filtered = orders.filter(order => {
                const matchesTab = order.type === activeOrdersTab;
                const matchesSource = order.source === activeOrderSource;
                const matchesSearch = order.orderId.toLowerCase().includes(search) ||
                                    order.sourceDestination.toLowerCase().includes(search);
                return matchesTab && matchesSource && matchesSearch;
            });

            filtered.forEach((order, idx) => {
                const tr = document.createElement('tr');
                if (idx === selectedItemIdx) tr.classList.add('selected-row');
                
                tr.onclick = () => selectOrderRow(idx);
                tr.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${order.sourceDestination}</td>
                    <td>${order.items}</td>
                    <td>$${order.total.toFixed(2)}</td>
                    <td>${order.date}</td>
                    <td>${order.status}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function selectOrderRow(idx) {
            selectedItemIdx = idx;
            renderOrderTable();
            document.getElementById('edit-order-btn').disabled = false;
            document.getElementById('delete-order-btn').disabled = false;
        }

        function showAddOrderModal() {
            editingOrderIdx = -1;
            document.getElementById('order-modal-title').textContent = 'Add Order';
            document.getElementById('order-form').reset();
            document.getElementById('order-modal').style.display = 'block';
        }

        function showEditOrderModal() {
            if (selectedItemIdx === -1) return;
            const filtered = orders.filter(order => {
                const matchesTab = order.type === activeOrdersTab;
                const matchesSource = order.source === activeOrderSource;
                return matchesTab && matchesSource;
            });
            editingOrderIdx = orders.indexOf(filtered[selectedItemIdx]);
            const order = orders[editingOrderIdx];
            
            document.getElementById('order-modal-title').textContent = 'Edit Order';
            document.getElementById('order-id').value = order.orderId;
            document.getElementById('order-source').value = order.sourceDestination;
            document.getElementById('order-items').value = order.items;
            document.getElementById('order-total').value = order.total;
            document.getElementById('order-date').value = order.date;
            document.getElementById('order-status').value = order.status;
            
            document.getElementById('order-modal').style.display = 'block';
        }

        function closeOrderModal() {
            document.getElementById('order-modal').style.display = 'none';
            editingOrderIdx = -1;
        }

        function saveOrder(e) {
            e.preventDefault();
            
            const order = {
                orderId: document.getElementById('order-id').value,
                sourceDestination: document.getElementById('order-source').value,
                items: document.getElementById('order-items').value,
                total: parseFloat(document.getElementById('order-total').value),
                date: document.getElementById('order-date').value,
                status: document.getElementById('order-status').value,
                type: activeOrdersTab,
                source: activeOrderSource
            };

            if (editingOrderIdx === -1) {
                orders.push(order);
            } else {
                orders[editingOrderIdx] = order;
            }

            localStorage.setItem('orders', JSON.stringify(orders));
            closeOrderModal();
            renderOrderTable();
        }

        function deleteOrder() {
            if (selectedItemIdx === -1) return;
            const filtered = orders.filter(order => {
                const matchesTab = order.type === activeOrdersTab;
                const matchesSource = order.source === activeOrderSource;
                return matchesTab && matchesSource;
            });
            const orderToDelete = filtered[selectedItemIdx];
            const actualIdx = orders.indexOf(orderToDelete);
            
            if (confirm('Are you sure you want to delete this order?')) {
                orders.splice(actualIdx, 1);
                localStorage.setItem('orders', JSON.stringify(orders));
                selectedItemIdx = -1;
                document.getElementById('edit-order-btn').disabled = true;
                document.getElementById('delete-order-btn').disabled = true;
                renderOrderTable();
            }
        }

        // Tracking functions
        function updateTrackingStats() {
            const totalTracking = tracking.length;
            const inTransit = tracking.filter(t => t.status === 'in-transit' || t.status === 'picked-up' || t.status === 'out-for-delivery').length;
            const delivered = tracking.filter(t => t.status === 'delivered').length;
            const pending = tracking.filter(t => t.status === 'pending').length;

            document.getElementById('tracking-total').textContent = totalTracking;
            document.getElementById('tracking-in-transit').textContent = inTransit;
            document.getElementById('tracking-delivered').textContent = delivered;
            document.getElementById('tracking-pending').textContent = pending;
        }

        function renderTrackingTable() {
            const search = document.getElementById('tracking-search').value.toLowerCase();
            const tbody = document.querySelector('#tracking-table tbody');
            tbody.innerHTML = '';

            const filtered = tracking.filter(t =>
                t.trackingNumber.toLowerCase().includes(search) ||
                t.carrier.toLowerCase().includes(search) ||
                t.origin.toLowerCase().includes(search) ||
                t.destination.toLowerCase().includes(search)
            );

            filtered.forEach((t, idx) => {
                const tr = document.createElement('tr');
                if (idx === selectedItemIdx) tr.classList.add('selected-row');
                
                tr.onclick = () => selectTrackingRow(idx);
                tr.innerHTML = `
                    <td>${t.trackingNumber}</td>
                    <td>${t.carrier}</td>
                    <td>${t.status}</td>
                    <td>${t.origin}</td>
                    <td>${t.destination}</td>
                    <td>${t.shipDate}</td>
                    <td>${t.estDelivery}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function selectTrackingRow(idx) {
            selectedItemIdx = idx;
            renderTrackingTable();
            document.getElementById('edit-tracking-btn').disabled = false;
            document.getElementById('delete-tracking-btn').disabled = false;
        }

        function showAddTrackingModal() {
            editingTrackingIdx = -1;
            document.getElementById('tracking-modal-title').textContent = 'Add Tracking';
            document.getElementById('tracking-form').reset();
            document.getElementById('tracking-modal').style.display = 'block';
        }

        function showEditTrackingModal() {
            if (selectedItemIdx === -1) return;
            editingTrackingIdx = selectedItemIdx;
            const t = tracking[selectedItemIdx];
            
            document.getElementById('tracking-modal-title').textContent = 'Edit Tracking';
            document.getElementById('tracking-number').value = t.trackingNumber;
            document.getElementById('tracking-carrier').value = t.carrier;
            document.getElementById('tracking-status').value = t.status;
            document.getElementById('tracking-origin').value = t.origin;
            document.getElementById('tracking-destination').value = t.destination;
            document.getElementById('tracking-ship-date').value = t.shipDate;
            document.getElementById('tracking-est-delivery').value = t.estDelivery;
            
            document.getElementById('tracking-modal').style.display = 'block';
        }

        function closeTrackingModal() {
            document.getElementById('tracking-modal').style.display = 'none';
            editingTrackingIdx = -1;
        }

        function saveTracking(e) {
            e.preventDefault();
            
            const t = {
                trackingNumber: document.getElementById('tracking-number').value,
                carrier: document.getElementById('tracking-carrier').value,
                status: document.getElementById('tracking-status').value,
                origin: document.getElementById('tracking-origin').value,
                destination: document.getElementById('tracking-destination').value,
                shipDate: document.getElementById('tracking-ship-date').value,
                estDelivery: document.getElementById('tracking-est-delivery').value
            };

            if (editingTrackingIdx === -1) {
                tracking.push(t);
            } else {
                tracking[editingTrackingIdx] = t;
            }

            localStorage.setItem('tracking', JSON.stringify(tracking));
            closeTrackingModal();
            renderTrackingTable();
            updateTrackingStats();
        }

        function deleteTracking() {
            if (selectedItemIdx === -1) return;
            if (confirm('Are you sure you want to delete this tracking?')) {
                tracking.splice(selectedItemIdx, 1);
                localStorage.setItem('tracking', JSON.stringify(tracking));
                selectedItemIdx = -1;
                document.getElementById('edit-tracking-btn').disabled = true;
                document.getElementById('delete-tracking-btn').disabled = true;
                renderTrackingTable();
                updateTrackingStats();
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>